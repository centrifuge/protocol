@startuml overview
title Centrifuge Protocol - Architecture Overview

!define CORE_COLOR #E1F5FE
!define MESSAGING_COLOR #F3E5F5
!define ADMIN_COLOR #FFF9C4
!define MANAGERS_COLOR #E8F5E9
!define VAULTS_COLOR #FCE4EC
!define ADAPTERS_COLOR #FFF3E0
!define HOOKS_COLOR #F1F8E9

left to right direction

package "Core" CORE_COLOR {
  component Hub
  component HubHandler
  component Spoke
  component Gateway
  component MultiAdapter
  component BatchedMulticall
  component Holdings
  component Accounting
  component ShareClassManager
  component BalanceSheet
  component VaultRegistry
}

package "Messaging" MESSAGING_COLOR {
  component MessageDispatcher
  component MessageProcessor
  component GasService
}

package "Admin" ADMIN_COLOR {
  component Root
  component OpsGuardian
  component ProtocolGuardian
  component TokenRecoverer
}

package "Adapters" ADAPTERS_COLOR {
  component AxelarAdapter
  component WormholeAdapter
  component LayerZeroAdapter
  component RecoveryAdapter
}

package "Managers" MANAGERS_COLOR {
  package "Hub Managers" {
    component NAVManager
    component SimplePriceManager
  }
  package "Spoke Managers" {
    component OnOfframpManager
    component MerkleProofManager
    component QueueManager
  }
}

package "Vaults" VAULTS_COLOR {
  component BaseVault
  component AsyncVault
  component SyncDepositVault
  component AsyncRequestManager
  component SyncManager
  component VaultRouter
  component RefundEscrow
  component BatchRequestManager
}

package "Hooks" HOOKS_COLOR {
  component BaseTransferHook
  component FreelyTransferable
  component FreezeOnly
  component FullRestrictions
  component RedemptionRestrictions
}

' Core
Hub --> Holdings
Hub --> Accounting
Hub --> ShareClassManager
Hub --> MessageDispatcher
Hub --> Gateway

HubHandler --> Hub
BatchRequestManager --> Hub

Spoke --> BalanceSheet
Spoke --> VaultRegistry
Spoke --> MessageDispatcher
Spoke --> Gateway

Gateway --> MultiAdapter
Gateway --> GasService

BatchedMulticall --> Gateway

' Messaging
MessageDispatcher --> Gateway
MessageProcessor --> Gateway
MessageProcessor --> Hub
MessageProcessor --> Spoke

' Adapters
MultiAdapter --> AxelarAdapter
MultiAdapter --> WormholeAdapter
MultiAdapter --> LayerZeroAdapter
MultiAdapter --> RecoveryAdapter

' Managers
NAVManager -left-> Hub
SimplePriceManager -left-> Hub
OnOfframpManager -right-> BalanceSheet
MerkleProofManager -right-> BalanceSheet
QueueManager -right-> BalanceSheet

' Vaults
VaultRegistry --> AsyncVault
VaultRegistry --> SyncDepositVault
AsyncVault --> AsyncRequestManager
SyncDepositVault --> SyncManager

' Admin
OpsGuardian --> Hub
OpsGuardian --> Root
OpsGuardian --> Gateway
ProtocolGuardian --> Hub
ProtocolGuardian --> Root
ProtocolGuardian --> Gateway
TokenRecoverer --> Root

@enduml
